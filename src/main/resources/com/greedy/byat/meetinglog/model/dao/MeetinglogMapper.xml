<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.greedy.byat.meetinglog.model.dao.MeetinglogMapper">
 	
 	<resultMap id ="meetinglogResultMap" type="MeetinglogDTO">
 		<id property="code" column="MEETINGLOG_CODE"/>
 		<result property="title" column="MEETINGLã„´OG_TITLE"/>
 		<result property="body" column="MEETINGLOG_BODY"/>
 		<result property="writingDate" column="MEETINGLOG_WRITING_DATE"/>
 		<result property="version" column="MEETINGLOG_VERSION"/>
 		<result property="deleteStatus" column="MEETINGLOG_DELETE_STATUS"/>
 		<result property="projectCode" column="PROJECT_CODE"/>
 		<result property="memberNo" column="MEMBER_NO"/>
 		<result property="memberName" column="MEMBER_NAME"/>
 	</resultMap>

	<resultMap id="noticeResultMap" type="NoticeDTO" >
		<id property="code" column="NOTICE_CODE"/>
		<result property="body" column="NOTICE_BODY"/>
		<result property="url" column="NOTICE_URL"/>
		<result property="status" column="NOTICE_STATUS"/>
		<result property="category" column="NOTICE_CATEGORY_CODE"/>
		<result property="meetinglogCode" column="MEETINGLOG_CODE"/>
		<result property="createdTime" column="NOTICE_TIME"/>
	</resultMap>
 	
 	 	<select id="selectProjectName" resultType="string">
 		SELECT
 		       A.PROJECT_TITLE
 		  FROM TBL_PROJECT A
 		 WHERE A.PROJECT_CODE = #{ projectCode }
 	</select>
 	
 	<select id="selectMeetinglogList" resultMap="meetinglogResultMap">
 		SELECT
			   A.MEETINGLOG_CODE
			 , A.MEETINGLOG_TITLE
			 , A.MEETINGLOG_BODY
			 , A.MEETINGLOG_WRITING_DATE
			 , A.MEETINGLOG_VERSION
			 , A.MEETINGLOG_DELETE_STATUS
			 , A.PROJECT_CODE
			 , A.MEMBER_NO
			 , A.MEMBER_NAME 
		  FROM TBL_MEETINGLOG A
		  JOIN TBL_MEMBER B ON(A.MEMBER_NO = B.MEMBER_NO)
		 WHERE A.PROJECT_CODE = #{ projectCode }
		   AND A.MEETINGLOG_DELETE_STATUS = 'N'
		 ORDER BY MEETINGLOG_CODE DESC 
 	</select>
 	
 	<select id="selectMeetinglogDetail" resultMap = "meetinglogResultMap">
 		SELECT
			   A.MEETINGLOG_CODE
			 , A.MEETINGLOG_TITLE
			 , A.MEETINGLOG_BODY
			 , A.MEETINGLOG_WRITING_DATE
			 , A.MEETINGLOG_DELETE_STATUS
			 , A.MEETINGLOG_VERSION
			 , A.MEMBER_NO
			 , A.MEMBER_NAME 
		  FROM TBL_MEETINGLOG A 
		  JOIN TBL_MEMBER B ON(A.MEMBER_NO = B.MEMBER_NO)
		 WHERE A.MEETINGLOG_CODE = #{ code }
		 ORDER BY MEETINGLOG_CODE DESC
 	</select>

 	
 	<insert id="registMeetinglog" parameterType="MeetinglogDTO">
 		INSERT
 		  INTO TBL_MEETINGLOG A
 		(
 		 	A.MEETINGLOG_CODE
		, A.MEETINGLOG_TITLE
		, A.MEETINGLOG_BODY
		, A.MEETINGLOG_WRITING_DATE
		, A.MEETINGLOG_VERSION
		, A.MEETINGLOG_DELETE_STATUS
		, A.MEMBER_NO
		, A.PROJECT_CODE
		, A.MEMBER_NAME
 		)
 		VALUES
 		(
 		  SEQ_PROJECT_NO.NEXTVAL
 		, #{ title } 
 		, #{ body }
 		, TO_DATE(SYSDATE)
 		, 1
 		, 'N'
 		, #{ memberNo }
 		, #{ projectCode }
 		, #{ memberName }
 		)
 	</insert>

 	<update id="modifyMeetinglog" parameterType="MeetinglogDTO">
 		UPDATE
 		       TBL_MEETINGLOG A
 		   SET A.MEETINGLOG_TITLE = #{ title }
			 , A.MEETINGLOG_WRITING_DATE = TO_DATE(SYSDATE)
 		     , A.MEETINGLOG_BODY = #{ body }
 		 WHERE A.MEETINGLOG_CODE = #{ code }
 	</update>
 	
 	<update id="insertVersion">
        UPDATE
               TBL_MEETINGLOG A
           SET A.MEETINGLOG_VERSION = (SELECT B.MEETINGLOG_VERSION
                                  FROM TBL_MEETINGLOG B
                                 WHERE B.MEETINGLOG_CODE = #{ code }
                               ) + 1
         WHERE A.MEETINGLOG_CODE = #{ code }
	</update>
	
	<update id="removeMeetinglog">
		UPDATE
 		       TBL_MEETINGLOG A
 		   SET A.MEETINGLOG_DELETE_STATUS = 'Y'
 		 WHERE A.MEETINGLOG_CODE = #{ code }
	
	</update>
 	
 	<insert id="registMeetinglogHistory" parameterType="MeetingLogDTO">
 	INSERT
 		  INTO TBL_MEETINGLOG_HISTORY A
 		(
 		  A.MEETINGLOG_HISTORY_NO				
		, A.MEETINGLOG_HISTORY_TITLE
		, A.MEETINGLOG_HISTORY_BODY
		, A.MEETINGLOG_HISTORY_VERSION
		, A.MEETINGLOG_HISTORY_UPDATE_MEMBER
		, A.MEETINGLOG_CODE
		, A.MEETINGLOG_HISTORY_UPDATE_DATE
		, A.MEETINGLOG_HISTORY_DELETE_STATUS
 		)
 		VALUES
 		(
 		  SEQ_PROJECT_NO.NEXTVAL
 		, #{ title } 
 		, #{ body }
 		, #{ version }
 		, #{ memberName }
 		, #{ code }
 		, #{ writingDate }
 		, #{ deleteStatus }
 		)
 	</insert>
 	
 	<insert id="registNoticeCode" parameterType="NoticeDTO">
 	INSERT
 		  INTO TBL_NOTICE A
 		(
 		  A.NOTICE_CODE				
		, A.NOTICE_BODY
		, A.NOTICE_URL
		, A.NOTICE_STATUS
		, A.NOTICE_CATEGORY_CODE
		, A.MEETINGLOG_CODE
		, A.NOTICE_TIME
 		)
 		VALUES
 		(
 		  SEQ_PROJECT_NO.NEXTVAL
 		, #{ body } 
 		, #{ url }
 		, 'N'
 		, '5'
 		, #{ meetinglogCode }
 		, TO_DATE(SYSDATE)
 		)
 	</insert>
 </mapper>